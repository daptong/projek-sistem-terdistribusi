{"ast":null,"code":"import _objectSpread from\"/home/aryo/projek-sistem-terdistribusi/projek-sistem-terdistribusi/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useRef}from'react';import DeviceList from'./components/DeviceList';import{getDevices}from'./services/api';import{connectWebSocket}from'./services/ws';import'./styles.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function App(){const[devices,setDevices]=useState([]);const[loading,setLoading]=useState(true);const[realtime,setRealtime]=useState(false);const[wsStatus,setWsStatus]=useState('disconnected');const[lastUpdated,setLastUpdated]=useState(null);const wsRef=useRef(null);const load=async()=>{try{setLoading(true);const d=await getDevices();setDevices(d);setLastUpdated(new Date().toISOString());}catch(e){setDevices([]);}finally{setLoading(false);}};// initial load only; manual refresh via the Refresh button\nuseEffect(()=>{load();},[]);// Manage WebSocket connection when realtime toggle changes\nuseEffect(()=>{// turn on realtime: open WS; turn off: close WS\nif(realtime){setWsStatus('connecting');wsRef.current=connectWebSocket(msg=>{try{if(!msg)return;if(msg.type==='mqtt'&&msg.topic){const parts=msg.topic.split('/');const deviceId=parts[2];if(!deviceId)return;setDevices(prev=>{const idx=prev.findIndex(d=>d.id===deviceId||d.device_id===deviceId);if(idx===-1)return prev;const copy=[...prev];const payload=msg.payload||{};copy[idx]=_objectSpread(_objectSpread({},copy[idx]),{},{last_telemetry:payload,state:payload.state||copy[idx].state});return copy;});setLastUpdated(new Date().toISOString());}}catch(e){console.warn('ws msg handler error',e);}},{onOpen:()=>setWsStatus('connected'),onClose:()=>setWsStatus('disconnected')});}else{if(wsRef.current){try{wsRef.current.close();}catch(e){}wsRef.current=null;setWsStatus('disconnected');}}// cleanup on unmount\nreturn()=>{if(wsRef.current){try{wsRef.current.close();}catch(e){}wsRef.current=null;}};},[realtime]);return/*#__PURE__*/_jsxs(\"div\",{className:\"app-root\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"title\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83C\\uDFE1 IoT Home Dashboard\"}),/*#__PURE__*/_jsx(\"div\",{className:\"small\",children:\"MQTT & Web UI\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:load,children:\"Refresh\"}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',gap:'6px'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:realtime,onChange:e=>setRealtime(e.target.checked)}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'12px'},children:\"Real-time\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:12,color:'#888'},children:[realtime?\"WS: \".concat(wsStatus):\"Mode: Manual\",lastUpdated?\" \\u2022 Updated: \".concat(new Date(lastUpdated).toLocaleTimeString()):'']})]})]}),/*#__PURE__*/_jsx(DeviceList,{devices:devices,loading:loading})]});}","map":{"version":3,"names":["React","useEffect","useState","useRef","DeviceList","getDevices","connectWebSocket","jsx","_jsx","jsxs","_jsxs","App","devices","setDevices","loading","setLoading","realtime","setRealtime","wsStatus","setWsStatus","lastUpdated","setLastUpdated","wsRef","load","d","Date","toISOString","e","current","msg","type","topic","parts","split","deviceId","prev","idx","findIndex","id","device_id","copy","payload","_objectSpread","last_telemetry","state","console","warn","onOpen","onClose","close","className","children","style","display","alignItems","gap","onClick","checked","onChange","target","fontSize","color","concat","toLocaleTimeString"],"sources":["/home/aryo/projek-sistem-terdistribusi/projek-sistem-terdistribusi/ui/src/App.jsx"],"sourcesContent":["import React, {useEffect, useState, useRef} from 'react'\nimport DeviceList from './components/DeviceList'\nimport { getDevices } from './services/api'\nimport { connectWebSocket } from './services/ws'\nimport './styles.css'\n\nexport default function App(){\n  const [devices, setDevices] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [realtime, setRealtime] = useState(false)\n  const [wsStatus, setWsStatus] = useState('disconnected')\n  const [lastUpdated, setLastUpdated] = useState(null)\n  const wsRef = useRef(null)\n\n  const load = async ()=>{\n    try{\n      setLoading(true)\n      const d = await getDevices()\n      setDevices(d)\n      setLastUpdated(new Date().toISOString())\n    }catch(e){\n      setDevices([])\n    }finally{\n      setLoading(false)\n    }\n  }\n\n  // initial load only; manual refresh via the Refresh button\n  useEffect(()=>{ load() }, [])\n\n  // Manage WebSocket connection when realtime toggle changes\n  useEffect(()=>{\n    // turn on realtime: open WS; turn off: close WS\n    if(realtime){\n      setWsStatus('connecting')\n      wsRef.current = connectWebSocket((msg)=>{\n        try{\n          if(!msg) return\n          if(msg.type === 'mqtt' && msg.topic){\n            const parts = msg.topic.split('/')\n            const deviceId = parts[2]\n            if(!deviceId) return\n            setDevices(prev => {\n              const idx = prev.findIndex(d => d.id === deviceId || d.device_id === deviceId)\n              if(idx === -1) return prev\n              const copy = [...prev]\n              const payload = msg.payload || {}\n              copy[idx] = {\n                ...copy[idx],\n                last_telemetry: payload,\n                state: payload.state || copy[idx].state\n              }\n              return copy\n            })\n            setLastUpdated(new Date().toISOString())\n          }\n        }catch(e){\n          console.warn('ws msg handler error', e)\n        }\n      }, {\n        onOpen: ()=> setWsStatus('connected'),\n        onClose: ()=> setWsStatus('disconnected')\n      })\n    }else{\n      if(wsRef.current){\n        try{ wsRef.current.close() }catch(e){}\n        wsRef.current = null\n        setWsStatus('disconnected')\n      }\n    }\n    // cleanup on unmount\n    return ()=>{\n      if(wsRef.current){ try{ wsRef.current.close() }catch(e){} wsRef.current = null }\n    }\n  }, [realtime])\n\n  return (\n    <div className='app-root'>\n      <div className='header'>\n        <div className='title'>\n          <h1>üè° IoT Home Dashboard</h1>\n          <div className='small'>MQTT & Web UI</div>\n        </div>\n        <div style={{display:'flex',alignItems:'center',gap:'8px'}}>\n          <button className='btn' onClick={load}>Refresh</button>\n          <label style={{display:'flex',alignItems:'center',gap:'6px'}}>\n            <input type='checkbox' checked={realtime} onChange={(e)=>setRealtime(e.target.checked)} />\n            <span style={{fontSize:'12px'}}>Real-time</span>\n          </label>\n          <div style={{fontSize:12,color:'#888'}}>\n            {realtime ? `WS: ${wsStatus}` : `Mode: Manual`}\n            {lastUpdated ? ` ‚Ä¢ Updated: ${new Date(lastUpdated).toLocaleTimeString()}` : ''}\n          </div>\n        </div>\n      </div>\n\n      <DeviceList devices={devices} loading={loading} />\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}