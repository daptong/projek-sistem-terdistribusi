{"ast":null,"code":"import _objectSpread from\"/home/aryo/projek-sistem-terdistribusi/projek-sistem-terdistribusi/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import DeviceList from'./components/DeviceList';import{getDevices}from'./services/api';import{connectWebSocket}from'./services/ws';import'./styles.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function App(){const[devices,setDevices]=useState([]);const[loading,setLoading]=useState(true);const load=async()=>{try{setLoading(true);const d=await getDevices();setDevices(d);}catch(e){setDevices([]);}finally{setLoading(false);}};useEffect(()=>{load();const t=setInterval(load,5000);return()=>clearInterval(t);},[]);// WebSocket for real-time updates from backend (MQTT -> backend -> WS)\nuseEffect(()=>{const conn=connectWebSocket(msg=>{try{if(!msg)return;if(msg.type==='mqtt'&&msg.topic){// topic format: home/{device_type}/{device_id}/...\nconst parts=msg.topic.split('/');const deviceId=parts[2];if(!deviceId)return;setDevices(prev=>{const idx=prev.findIndex(d=>d.id===deviceId||d.device_id===deviceId);if(idx===-1)return prev;const copy=[...prev];// merge payload into device state where appropriate\nconst payload=msg.payload||{};copy[idx]=_objectSpread(_objectSpread({},copy[idx]),{},{last_telemetry:payload,state:payload.state||copy[idx].state});return copy;});}}catch(e){console.warn('ws msg handler error',e);}});return()=>conn.close();},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"app-root\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"title\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83C\\uDFE1 IoT Home Dashboard\"}),/*#__PURE__*/_jsx(\"div\",{className:\"small\",children:\"MQTT & Web UI\"})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:load,children:\"Refresh\"})})]}),/*#__PURE__*/_jsx(DeviceList,{devices:devices,loading:loading})]});}","map":{"version":3,"names":["React","useEffect","useState","DeviceList","getDevices","connectWebSocket","jsx","_jsx","jsxs","_jsxs","App","devices","setDevices","loading","setLoading","load","d","e","t","setInterval","clearInterval","conn","msg","type","topic","parts","split","deviceId","prev","idx","findIndex","id","device_id","copy","payload","_objectSpread","last_telemetry","state","console","warn","close","className","children","onClick"],"sources":["/home/aryo/projek-sistem-terdistribusi/projek-sistem-terdistribusi/ui/src/App.jsx"],"sourcesContent":["import React, {useEffect, useState} from 'react'\nimport DeviceList from './components/DeviceList'\nimport { getDevices } from './services/api'\nimport { connectWebSocket } from './services/ws'\nimport './styles.css'\n\nexport default function App(){\n  const [devices, setDevices] = useState([])\n  const [loading, setLoading] = useState(true)\n\n  const load = async ()=>{\n    try{\n      setLoading(true)\n      const d = await getDevices()\n      setDevices(d)\n    }catch(e){\n      setDevices([])\n    }finally{\n      setLoading(false)\n    }\n  }\n\n  useEffect(()=>{\n    load()\n    const t = setInterval(load, 5000)\n    return ()=>clearInterval(t)\n  },[])\n\n  // WebSocket for real-time updates from backend (MQTT -> backend -> WS)\n  useEffect(()=>{\n    const conn = connectWebSocket((msg)=>{\n      try{\n        if(!msg) return\n        if(msg.type === 'mqtt' && msg.topic){\n          // topic format: home/{device_type}/{device_id}/...\n          const parts = msg.topic.split('/')\n          const deviceId = parts[2]\n          if(!deviceId) return\n          setDevices(prev => {\n            const idx = prev.findIndex(d => d.id === deviceId || d.device_id === deviceId)\n            if(idx === -1) return prev\n            const copy = [...prev]\n            // merge payload into device state where appropriate\n            const payload = msg.payload || {}\n            copy[idx] = {\n              ...copy[idx],\n              last_telemetry: payload,\n              state: payload.state || copy[idx].state\n            }\n            return copy\n          })\n        }\n      }catch(e){\n        console.warn('ws msg handler error', e)\n      }\n    })\n    return ()=>conn.close()\n  }, [])\n\n  return (\n    <div className='app-root'>\n      <div className='header'>\n        <div className='title'>\n          <h1>üè° IoT Home Dashboard</h1>\n          <div className='small'>MQTT & Web UI</div>\n        </div>\n        <div>\n          <button className='btn' onClick={load}>Refresh</button>\n        </div>\n      </div>\n\n      <DeviceList devices={devices} loading={loading} />\n    </div>\n  )\n}\n"],"mappings":"0JAAA,MAAO,CAAAA,KAAK,EAAGC,SAAS,CAAEC,QAAQ,KAAO,OAAO,CAChD,MAAO,CAAAC,UAAU,KAAM,yBAAyB,CAChD,OAASC,UAAU,KAAQ,gBAAgB,CAC3C,OAASC,gBAAgB,KAAQ,eAAe,CAChD,MAAO,cAAc,QAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAErB,cAAe,SAAS,CAAAC,GAAGA,CAAA,CAAE,CAC3B,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGV,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACW,OAAO,CAAEC,UAAU,CAAC,CAAGZ,QAAQ,CAAC,IAAI,CAAC,CAE5C,KAAM,CAAAa,IAAI,CAAG,KAAAA,CAAA,GAAU,CACrB,GAAG,CACDD,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAAE,CAAC,CAAG,KAAM,CAAAZ,UAAU,CAAC,CAAC,CAC5BQ,UAAU,CAACI,CAAC,CAAC,CACf,CAAC,MAAMC,CAAC,CAAC,CACPL,UAAU,CAAC,EAAE,CAAC,CAChB,CAAC,OAAO,CACNE,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAEDb,SAAS,CAAC,IAAI,CACZc,IAAI,CAAC,CAAC,CACN,KAAM,CAAAG,CAAC,CAAGC,WAAW,CAACJ,IAAI,CAAE,IAAI,CAAC,CACjC,MAAO,IAAIK,aAAa,CAACF,CAAC,CAAC,CAC7B,CAAC,CAAC,EAAE,CAAC,CAEL;AACAjB,SAAS,CAAC,IAAI,CACZ,KAAM,CAAAoB,IAAI,CAAGhB,gBAAgB,CAAEiB,GAAG,EAAG,CACnC,GAAG,CACD,GAAG,CAACA,GAAG,CAAE,OACT,GAAGA,GAAG,CAACC,IAAI,GAAK,MAAM,EAAID,GAAG,CAACE,KAAK,CAAC,CAClC;AACA,KAAM,CAAAC,KAAK,CAAGH,GAAG,CAACE,KAAK,CAACE,KAAK,CAAC,GAAG,CAAC,CAClC,KAAM,CAAAC,QAAQ,CAAGF,KAAK,CAAC,CAAC,CAAC,CACzB,GAAG,CAACE,QAAQ,CAAE,OACdf,UAAU,CAACgB,IAAI,EAAI,CACjB,KAAM,CAAAC,GAAG,CAAGD,IAAI,CAACE,SAAS,CAACd,CAAC,EAAIA,CAAC,CAACe,EAAE,GAAKJ,QAAQ,EAAIX,CAAC,CAACgB,SAAS,GAAKL,QAAQ,CAAC,CAC9E,GAAGE,GAAG,GAAK,CAAC,CAAC,CAAE,MAAO,CAAAD,IAAI,CAC1B,KAAM,CAAAK,IAAI,CAAG,CAAC,GAAGL,IAAI,CAAC,CACtB;AACA,KAAM,CAAAM,OAAO,CAAGZ,GAAG,CAACY,OAAO,EAAI,CAAC,CAAC,CACjCD,IAAI,CAACJ,GAAG,CAAC,CAAAM,aAAA,CAAAA,aAAA,IACJF,IAAI,CAACJ,GAAG,CAAC,MACZO,cAAc,CAAEF,OAAO,CACvBG,KAAK,CAAEH,OAAO,CAACG,KAAK,EAAIJ,IAAI,CAACJ,GAAG,CAAC,CAACQ,KAAK,EACxC,CACD,MAAO,CAAAJ,IAAI,CACb,CAAC,CAAC,CACJ,CACF,CAAC,MAAMhB,CAAC,CAAC,CACPqB,OAAO,CAACC,IAAI,CAAC,sBAAsB,CAAEtB,CAAC,CAAC,CACzC,CACF,CAAC,CAAC,CACF,MAAO,IAAII,IAAI,CAACmB,KAAK,CAAC,CAAC,CACzB,CAAC,CAAE,EAAE,CAAC,CAEN,mBACE/B,KAAA,QAAKgC,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBjC,KAAA,QAAKgC,SAAS,CAAC,QAAQ,CAAAC,QAAA,eACrBjC,KAAA,QAAKgC,SAAS,CAAC,OAAO,CAAAC,QAAA,eACpBnC,IAAA,OAAAmC,QAAA,CAAI,iCAAqB,CAAI,CAAC,cAC9BnC,IAAA,QAAKkC,SAAS,CAAC,OAAO,CAAAC,QAAA,CAAC,eAAa,CAAK,CAAC,EACvC,CAAC,cACNnC,IAAA,QAAAmC,QAAA,cACEnC,IAAA,WAAQkC,SAAS,CAAC,KAAK,CAACE,OAAO,CAAE5B,IAAK,CAAA2B,QAAA,CAAC,SAAO,CAAQ,CAAC,CACpD,CAAC,EACH,CAAC,cAENnC,IAAA,CAACJ,UAAU,EAACQ,OAAO,CAAEA,OAAQ,CAACE,OAAO,CAAEA,OAAQ,CAAE,CAAC,EAC/C,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}