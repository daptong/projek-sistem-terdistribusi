{"ast":null,"code":"// Simple WebSocket client with auto-reconnect and message callback\nconst WS_URL = (() => {\n  const loc = window.location;\n  return (loc.protocol === 'https:' ? 'wss://' : 'ws://') + loc.host + '/ws';\n})();\nexport function connectWebSocket(onMessage) {\n  let ws = null;\n  let closedByUser = false;\n  let reconnectTimer = null;\n  function create() {\n    ws = new WebSocket(WS_URL);\n    ws.onopen = () => {\n      console.log('[ws] connected');\n      if (reconnectTimer) {\n        clearTimeout(reconnectTimer);\n        reconnectTimer = null;\n      }\n    };\n    ws.onmessage = ev => {\n      try {\n        const data = JSON.parse(ev.data);\n        onMessage && onMessage(data);\n      } catch (e) {\n        console.warn('[ws] invalid message', e);\n      }\n    };\n    ws.onclose = () => {\n      console.log('[ws] closed');\n      if (!closedByUser) {\n        // simple reconnect\n        reconnectTimer = setTimeout(create, 2000);\n      }\n    };\n    ws.onerror = err => {\n      console.warn('[ws] error', err);\n      try {\n        ws.close();\n      } catch (e) {}\n    };\n  }\n  create();\n  return {\n    close: () => {\n      closedByUser = true;\n      if (reconnectTimer) clearTimeout(reconnectTimer);\n      try {\n        ws && ws.close();\n      } catch (e) {}\n    }\n  };\n}","map":{"version":3,"names":["WS_URL","loc","window","location","protocol","host","connectWebSocket","onMessage","ws","closedByUser","reconnectTimer","create","WebSocket","onopen","console","log","clearTimeout","onmessage","ev","data","JSON","parse","e","warn","onclose","setTimeout","onerror","err","close"],"sources":["/home/aryo/projek-sistem-terdistribusi/projek-sistem-terdistribusi/ui/src/services/ws.js"],"sourcesContent":["// Simple WebSocket client with auto-reconnect and message callback\nconst WS_URL = (() => {\n  const loc = window.location\n  return (loc.protocol === 'https:' ? 'wss://' : 'ws://') + loc.host + '/ws'\n})();\n\nexport function connectWebSocket(onMessage) {\n  let ws = null\n  let closedByUser = false\n  let reconnectTimer = null\n\n  function create() {\n    ws = new WebSocket(WS_URL)\n\n    ws.onopen = () => {\n      console.log('[ws] connected')\n      if (reconnectTimer) {\n        clearTimeout(reconnectTimer)\n        reconnectTimer = null\n      }\n    }\n\n    ws.onmessage = (ev) => {\n      try {\n        const data = JSON.parse(ev.data)\n        onMessage && onMessage(data)\n      } catch (e) {\n        console.warn('[ws] invalid message', e)\n      }\n    }\n\n    ws.onclose = () => {\n      console.log('[ws] closed')\n      if (!closedByUser) {\n        // simple reconnect\n        reconnectTimer = setTimeout(create, 2000)\n      }\n    }\n\n    ws.onerror = (err) => {\n      console.warn('[ws] error', err)\n      try {\n        ws.close()\n      } catch (e) {}\n    }\n  }\n\n  create()\n\n  return {\n    close: () => {\n      closedByUser = true\n      if (reconnectTimer) clearTimeout(reconnectTimer)\n      try {\n        ws && ws.close()\n      } catch (e) {}\n    },\n  }\n}\n"],"mappings":"AAAA;AACA,MAAMA,MAAM,GAAG,CAAC,MAAM;EACpB,MAAMC,GAAG,GAAGC,MAAM,CAACC,QAAQ;EAC3B,OAAO,CAACF,GAAG,CAACG,QAAQ,KAAK,QAAQ,GAAG,QAAQ,GAAG,OAAO,IAAIH,GAAG,CAACI,IAAI,GAAG,KAAK;AAC5E,CAAC,EAAE,CAAC;AAEJ,OAAO,SAASC,gBAAgBA,CAACC,SAAS,EAAE;EAC1C,IAAIC,EAAE,GAAG,IAAI;EACb,IAAIC,YAAY,GAAG,KAAK;EACxB,IAAIC,cAAc,GAAG,IAAI;EAEzB,SAASC,MAAMA,CAAA,EAAG;IAChBH,EAAE,GAAG,IAAII,SAAS,CAACZ,MAAM,CAAC;IAE1BQ,EAAE,CAACK,MAAM,GAAG,MAAM;MAChBC,OAAO,CAACC,GAAG,CAAC,gBAAgB,CAAC;MAC7B,IAAIL,cAAc,EAAE;QAClBM,YAAY,CAACN,cAAc,CAAC;QAC5BA,cAAc,GAAG,IAAI;MACvB;IACF,CAAC;IAEDF,EAAE,CAACS,SAAS,GAAIC,EAAE,IAAK;MACrB,IAAI;QACF,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACH,EAAE,CAACC,IAAI,CAAC;QAChCZ,SAAS,IAAIA,SAAS,CAACY,IAAI,CAAC;MAC9B,CAAC,CAAC,OAAOG,CAAC,EAAE;QACVR,OAAO,CAACS,IAAI,CAAC,sBAAsB,EAAED,CAAC,CAAC;MACzC;IACF,CAAC;IAEDd,EAAE,CAACgB,OAAO,GAAG,MAAM;MACjBV,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC;MAC1B,IAAI,CAACN,YAAY,EAAE;QACjB;QACAC,cAAc,GAAGe,UAAU,CAACd,MAAM,EAAE,IAAI,CAAC;MAC3C;IACF,CAAC;IAEDH,EAAE,CAACkB,OAAO,GAAIC,GAAG,IAAK;MACpBb,OAAO,CAACS,IAAI,CAAC,YAAY,EAAEI,GAAG,CAAC;MAC/B,IAAI;QACFnB,EAAE,CAACoB,KAAK,CAAC,CAAC;MACZ,CAAC,CAAC,OAAON,CAAC,EAAE,CAAC;IACf,CAAC;EACH;EAEAX,MAAM,CAAC,CAAC;EAER,OAAO;IACLiB,KAAK,EAAEA,CAAA,KAAM;MACXnB,YAAY,GAAG,IAAI;MACnB,IAAIC,cAAc,EAAEM,YAAY,CAACN,cAAc,CAAC;MAChD,IAAI;QACFF,EAAE,IAAIA,EAAE,CAACoB,KAAK,CAAC,CAAC;MAClB,CAAC,CAAC,OAAON,CAAC,EAAE,CAAC;IACf;EACF,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}