{"ast":null,"code":"// Simple WebSocket client with auto-reconnect and message callback\nconst WS_URL=(()=>{const loc=window.location;return(loc.protocol==='https:'?'wss://':'ws://')+loc.host+'/ws';})();export function connectWebSocket(onMessage){let opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};// opts: { onOpen: fn, onClose: fn }\nlet ws=null;let closedByUser=false;let reconnectTimer=null;function create(){ws=new WebSocket(WS_URL);ws.onopen=()=>{console.log('[ws] connected');if(reconnectTimer){clearTimeout(reconnectTimer);reconnectTimer=null;}try{opts.onOpen&&opts.onOpen();}catch(e){console.warn(e);}};ws.onmessage=ev=>{try{const data=JSON.parse(ev.data);onMessage&&onMessage(data);}catch(e){console.warn('[ws] invalid message',e);}};ws.onclose=()=>{console.log('[ws] closed');try{opts.onClose&&opts.onClose();}catch(e){console.warn(e);}if(!closedByUser){// simple reconnect\nreconnectTimer=setTimeout(create,2000);}};ws.onerror=err=>{console.warn('[ws] error',err);try{ws.close();}catch(e){}};}create();return{close:()=>{closedByUser=true;if(reconnectTimer)clearTimeout(reconnectTimer);try{ws&&ws.close();}catch(e){}}};}","map":{"version":3,"names":["WS_URL","loc","window","location","protocol","host","connectWebSocket","onMessage","opts","arguments","length","undefined","ws","closedByUser","reconnectTimer","create","WebSocket","onopen","console","log","clearTimeout","onOpen","e","warn","onmessage","ev","data","JSON","parse","onclose","onClose","setTimeout","onerror","err","close"],"sources":["/home/aryo/projek-sistem-terdistribusi/projek-sistem-terdistribusi/ui/src/services/ws.js"],"sourcesContent":["// Simple WebSocket client with auto-reconnect and message callback\nconst WS_URL = (() => {\n  const loc = window.location\n  return (loc.protocol === 'https:' ? 'wss://' : 'ws://') + loc.host + '/ws'\n})();\n\nexport function connectWebSocket(onMessage, opts = {}) {\n  // opts: { onOpen: fn, onClose: fn }\n  let ws = null\n  let closedByUser = false\n  let reconnectTimer = null\n\n  function create() {\n    ws = new WebSocket(WS_URL)\n\n    ws.onopen = () => {\n      console.log('[ws] connected')\n      if (reconnectTimer) {\n        clearTimeout(reconnectTimer)\n        reconnectTimer = null\n      }\n      try { opts.onOpen && opts.onOpen() } catch (e) { console.warn(e) }\n    }\n\n    ws.onmessage = (ev) => {\n      try {\n        const data = JSON.parse(ev.data)\n        onMessage && onMessage(data)\n      } catch (e) {\n        console.warn('[ws] invalid message', e)\n      }\n    }\n\n    ws.onclose = () => {\n      console.log('[ws] closed')\n      try { opts.onClose && opts.onClose() } catch (e) { console.warn(e) }\n      if (!closedByUser) {\n        // simple reconnect\n        reconnectTimer = setTimeout(create, 2000)\n      }\n    }\n\n    ws.onerror = (err) => {\n      console.warn('[ws] error', err)\n      try {\n        ws.close()\n      } catch (e) {}\n    }\n  }\n\n  create()\n\n  return {\n    close: () => {\n      closedByUser = true\n      if (reconnectTimer) clearTimeout(reconnectTimer)\n      try {\n        ws && ws.close()\n      } catch (e) {}\n    },\n  }\n}\n"],"mappings":"AAAA;AACA,KAAM,CAAAA,MAAM,CAAG,CAAC,IAAM,CACpB,KAAM,CAAAC,GAAG,CAAGC,MAAM,CAACC,QAAQ,CAC3B,MAAO,CAACF,GAAG,CAACG,QAAQ,GAAK,QAAQ,CAAG,QAAQ,CAAG,OAAO,EAAIH,GAAG,CAACI,IAAI,CAAG,KAAK,CAC5E,CAAC,EAAE,CAAC,CAEJ,MAAO,SAAS,CAAAC,gBAAgBA,CAACC,SAAS,CAAa,IAAX,CAAAC,IAAI,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,CAAC,CAAC,CACnD;AACA,GAAI,CAAAG,EAAE,CAAG,IAAI,CACb,GAAI,CAAAC,YAAY,CAAG,KAAK,CACxB,GAAI,CAAAC,cAAc,CAAG,IAAI,CAEzB,QAAS,CAAAC,MAAMA,CAAA,CAAG,CAChBH,EAAE,CAAG,GAAI,CAAAI,SAAS,CAAChB,MAAM,CAAC,CAE1BY,EAAE,CAACK,MAAM,CAAG,IAAM,CAChBC,OAAO,CAACC,GAAG,CAAC,gBAAgB,CAAC,CAC7B,GAAIL,cAAc,CAAE,CAClBM,YAAY,CAACN,cAAc,CAAC,CAC5BA,cAAc,CAAG,IAAI,CACvB,CACA,GAAI,CAAEN,IAAI,CAACa,MAAM,EAAIb,IAAI,CAACa,MAAM,CAAC,CAAC,CAAC,CAAE,MAAOC,CAAC,CAAE,CAAEJ,OAAO,CAACK,IAAI,CAACD,CAAC,CAAC,CAAC,CACnE,CAAC,CAEDV,EAAE,CAACY,SAAS,CAAIC,EAAE,EAAK,CACrB,GAAI,CACF,KAAM,CAAAC,IAAI,CAAGC,IAAI,CAACC,KAAK,CAACH,EAAE,CAACC,IAAI,CAAC,CAChCnB,SAAS,EAAIA,SAAS,CAACmB,IAAI,CAAC,CAC9B,CAAE,MAAOJ,CAAC,CAAE,CACVJ,OAAO,CAACK,IAAI,CAAC,sBAAsB,CAAED,CAAC,CAAC,CACzC,CACF,CAAC,CAEDV,EAAE,CAACiB,OAAO,CAAG,IAAM,CACjBX,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC,CAC1B,GAAI,CAAEX,IAAI,CAACsB,OAAO,EAAItB,IAAI,CAACsB,OAAO,CAAC,CAAC,CAAC,CAAE,MAAOR,CAAC,CAAE,CAAEJ,OAAO,CAACK,IAAI,CAACD,CAAC,CAAC,CAAC,CACnE,GAAI,CAACT,YAAY,CAAE,CACjB;AACAC,cAAc,CAAGiB,UAAU,CAAChB,MAAM,CAAE,IAAI,CAAC,CAC3C,CACF,CAAC,CAEDH,EAAE,CAACoB,OAAO,CAAIC,GAAG,EAAK,CACpBf,OAAO,CAACK,IAAI,CAAC,YAAY,CAAEU,GAAG,CAAC,CAC/B,GAAI,CACFrB,EAAE,CAACsB,KAAK,CAAC,CAAC,CACZ,CAAE,MAAOZ,CAAC,CAAE,CAAC,CACf,CAAC,CACH,CAEAP,MAAM,CAAC,CAAC,CAER,MAAO,CACLmB,KAAK,CAAEA,CAAA,GAAM,CACXrB,YAAY,CAAG,IAAI,CACnB,GAAIC,cAAc,CAAEM,YAAY,CAACN,cAAc,CAAC,CAChD,GAAI,CACFF,EAAE,EAAIA,EAAE,CAACsB,KAAK,CAAC,CAAC,CAClB,CAAE,MAAOZ,CAAC,CAAE,CAAC,CACf,CACF,CAAC,CACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}