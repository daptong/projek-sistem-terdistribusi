{"ast":null,"code":"// Simple WebSocket client with auto-reconnect and message callback\nconst WS_URL = (() => {\n  const loc = window.location;\n  return (loc.protocol === 'https:' ? 'wss://' : 'ws://') + loc.host + '/ws';\n})();\nexport function connectWebSocket(onMessage, opts = {}) {\n  // opts: { onOpen: fn, onClose: fn }\n  let ws = null;\n  let closedByUser = false;\n  let reconnectTimer = null;\n  function create() {\n    ws = new WebSocket(WS_URL);\n    ws.onopen = () => {\n      console.log('[ws] connected');\n      if (reconnectTimer) {\n        clearTimeout(reconnectTimer);\n        reconnectTimer = null;\n      }\n      try {\n        opts.onOpen && opts.onOpen();\n      } catch (e) {\n        console.warn(e);\n      }\n    };\n    ws.onmessage = ev => {\n      try {\n        const data = JSON.parse(ev.data);\n        onMessage && onMessage(data);\n      } catch (e) {\n        console.warn('[ws] invalid message', e);\n      }\n    };\n    ws.onclose = () => {\n      console.log('[ws] closed');\n      try {\n        opts.onClose && opts.onClose();\n      } catch (e) {\n        console.warn(e);\n      }\n      if (!closedByUser) {\n        // simple reconnect\n        reconnectTimer = setTimeout(create, 2000);\n      }\n    };\n    ws.onerror = err => {\n      console.warn('[ws] error', err);\n      try {\n        ws.close();\n      } catch (e) {}\n    };\n  }\n  create();\n  return {\n    close: () => {\n      closedByUser = true;\n      if (reconnectTimer) clearTimeout(reconnectTimer);\n      try {\n        ws && ws.close();\n      } catch (e) {}\n    }\n  };\n}","map":{"version":3,"names":["WS_URL","loc","window","location","protocol","host","connectWebSocket","onMessage","opts","ws","closedByUser","reconnectTimer","create","WebSocket","onopen","console","log","clearTimeout","onOpen","e","warn","onmessage","ev","data","JSON","parse","onclose","onClose","setTimeout","onerror","err","close"],"sources":["/home/aryo/projek-sistem-terdistribusi/projek-sistem-terdistribusi/ui/src/services/ws.js"],"sourcesContent":["// Simple WebSocket client with auto-reconnect and message callback\nconst WS_URL = (() => {\n  const loc = window.location\n  return (loc.protocol === 'https:' ? 'wss://' : 'ws://') + loc.host + '/ws'\n})();\n\nexport function connectWebSocket(onMessage, opts = {}) {\n  // opts: { onOpen: fn, onClose: fn }\n  let ws = null\n  let closedByUser = false\n  let reconnectTimer = null\n\n  function create() {\n    ws = new WebSocket(WS_URL)\n\n    ws.onopen = () => {\n      console.log('[ws] connected')\n      if (reconnectTimer) {\n        clearTimeout(reconnectTimer)\n        reconnectTimer = null\n      }\n      try { opts.onOpen && opts.onOpen() } catch (e) { console.warn(e) }\n    }\n\n    ws.onmessage = (ev) => {\n      try {\n        const data = JSON.parse(ev.data)\n        onMessage && onMessage(data)\n      } catch (e) {\n        console.warn('[ws] invalid message', e)\n      }\n    }\n\n    ws.onclose = () => {\n      console.log('[ws] closed')\n      try { opts.onClose && opts.onClose() } catch (e) { console.warn(e) }\n      if (!closedByUser) {\n        // simple reconnect\n        reconnectTimer = setTimeout(create, 2000)\n      }\n    }\n\n    ws.onerror = (err) => {\n      console.warn('[ws] error', err)\n      try {\n        ws.close()\n      } catch (e) {}\n    }\n  }\n\n  create()\n\n  return {\n    close: () => {\n      closedByUser = true\n      if (reconnectTimer) clearTimeout(reconnectTimer)\n      try {\n        ws && ws.close()\n      } catch (e) {}\n    },\n  }\n}\n"],"mappings":"AAAA;AACA,MAAMA,MAAM,GAAG,CAAC,MAAM;EACpB,MAAMC,GAAG,GAAGC,MAAM,CAACC,QAAQ;EAC3B,OAAO,CAACF,GAAG,CAACG,QAAQ,KAAK,QAAQ,GAAG,QAAQ,GAAG,OAAO,IAAIH,GAAG,CAACI,IAAI,GAAG,KAAK;AAC5E,CAAC,EAAE,CAAC;AAEJ,OAAO,SAASC,gBAAgBA,CAACC,SAAS,EAAEC,IAAI,GAAG,CAAC,CAAC,EAAE;EACrD;EACA,IAAIC,EAAE,GAAG,IAAI;EACb,IAAIC,YAAY,GAAG,KAAK;EACxB,IAAIC,cAAc,GAAG,IAAI;EAEzB,SAASC,MAAMA,CAAA,EAAG;IAChBH,EAAE,GAAG,IAAII,SAAS,CAACb,MAAM,CAAC;IAE1BS,EAAE,CAACK,MAAM,GAAG,MAAM;MAChBC,OAAO,CAACC,GAAG,CAAC,gBAAgB,CAAC;MAC7B,IAAIL,cAAc,EAAE;QAClBM,YAAY,CAACN,cAAc,CAAC;QAC5BA,cAAc,GAAG,IAAI;MACvB;MACA,IAAI;QAAEH,IAAI,CAACU,MAAM,IAAIV,IAAI,CAACU,MAAM,CAAC,CAAC;MAAC,CAAC,CAAC,OAAOC,CAAC,EAAE;QAAEJ,OAAO,CAACK,IAAI,CAACD,CAAC,CAAC;MAAC;IACnE,CAAC;IAEDV,EAAE,CAACY,SAAS,GAAIC,EAAE,IAAK;MACrB,IAAI;QACF,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACH,EAAE,CAACC,IAAI,CAAC;QAChChB,SAAS,IAAIA,SAAS,CAACgB,IAAI,CAAC;MAC9B,CAAC,CAAC,OAAOJ,CAAC,EAAE;QACVJ,OAAO,CAACK,IAAI,CAAC,sBAAsB,EAAED,CAAC,CAAC;MACzC;IACF,CAAC;IAEDV,EAAE,CAACiB,OAAO,GAAG,MAAM;MACjBX,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC;MAC1B,IAAI;QAAER,IAAI,CAACmB,OAAO,IAAInB,IAAI,CAACmB,OAAO,CAAC,CAAC;MAAC,CAAC,CAAC,OAAOR,CAAC,EAAE;QAAEJ,OAAO,CAACK,IAAI,CAACD,CAAC,CAAC;MAAC;MACnE,IAAI,CAACT,YAAY,EAAE;QACjB;QACAC,cAAc,GAAGiB,UAAU,CAAChB,MAAM,EAAE,IAAI,CAAC;MAC3C;IACF,CAAC;IAEDH,EAAE,CAACoB,OAAO,GAAIC,GAAG,IAAK;MACpBf,OAAO,CAACK,IAAI,CAAC,YAAY,EAAEU,GAAG,CAAC;MAC/B,IAAI;QACFrB,EAAE,CAACsB,KAAK,CAAC,CAAC;MACZ,CAAC,CAAC,OAAOZ,CAAC,EAAE,CAAC;IACf,CAAC;EACH;EAEAP,MAAM,CAAC,CAAC;EAER,OAAO;IACLmB,KAAK,EAAEA,CAAA,KAAM;MACXrB,YAAY,GAAG,IAAI;MACnB,IAAIC,cAAc,EAAEM,YAAY,CAACN,cAAc,CAAC;MAChD,IAAI;QACFF,EAAE,IAAIA,EAAE,CAACsB,KAAK,CAAC,CAAC;MAClB,CAAC,CAAC,OAAOZ,CAAC,EAAE,CAAC;IACf;EACF,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}