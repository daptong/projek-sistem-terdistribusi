{"ast":null,"code":"var _jsxFileName = \"/home/aryo/projek-sistem-terdistribusi/projek-sistem-terdistribusi/ui/src/App.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from 'react';\nimport DeviceList from './components/DeviceList';\nimport { getDevices } from './services/api';\nimport { connectWebSocket } from './services/ws';\nimport './styles.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function App() {\n  _s();\n  const [devices, setDevices] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [realtime, setRealtime] = useState(false);\n  const [wsStatus, setWsStatus] = useState('disconnected');\n  const [lastUpdated, setLastUpdated] = useState(null);\n  const wsRef = useRef(null);\n  const load = async () => {\n    try {\n      setLoading(true);\n      const d = await getDevices();\n      setDevices(d);\n      setLastUpdated(new Date().toISOString());\n    } catch (e) {\n      setDevices([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // initial load only; manual refresh via the Refresh button\n  useEffect(() => {\n    load();\n  }, []);\n\n  // Manage WebSocket connection when realtime toggle changes\n  useEffect(() => {\n    // turn on realtime: open WS; turn off: close WS\n    if (realtime) {\n      setWsStatus('connecting');\n      wsRef.current = connectWebSocket(msg => {\n        try {\n          if (!msg) return;\n          if (msg.type === 'mqtt' && msg.topic) {\n            const parts = msg.topic.split('/');\n            const deviceId = parts[2];\n            if (!deviceId) return;\n            setDevices(prev => {\n              const idx = prev.findIndex(d => d.id === deviceId || d.device_id === deviceId);\n              if (idx === -1) return prev;\n              const copy = [...prev];\n              const payload = msg.payload || {};\n              copy[idx] = {\n                ...copy[idx],\n                last_telemetry: payload,\n                state: payload.state || copy[idx].state\n              };\n              return copy;\n            });\n            setLastUpdated(new Date().toISOString());\n          }\n        } catch (e) {\n          console.warn('ws msg handler error', e);\n        }\n      }, {\n        onOpen: () => setWsStatus('connected'),\n        onClose: () => setWsStatus('disconnected')\n      });\n    } else {\n      if (wsRef.current) {\n        try {\n          wsRef.current.close();\n        } catch (e) {}\n        wsRef.current = null;\n        setWsStatus('disconnected');\n      }\n    }\n    // cleanup on unmount\n    return () => {\n      if (wsRef.current) {\n        try {\n          wsRef.current.close();\n        } catch (e) {}\n        wsRef.current = null;\n      }\n    };\n  }, [realtime]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"app-root\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"title\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"\\uD83C\\uDFE1 IoT Home Dashboard\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"small\",\n          children: \"MQTT & Web UI\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          gap: '8px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: load,\n          children: \"Refresh\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          style: {\n            display: 'flex',\n            alignItems: 'center',\n            gap: '6px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            checked: realtime,\n            onChange: e => setRealtime(e.target.checked)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              fontSize: '12px'\n            },\n            children: \"Real-time\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 12,\n            color: '#888'\n          },\n          children: [realtime ? `WS: ${wsStatus}` : `Mode: Manual`, lastUpdated ? ` ‚Ä¢ Updated: ${new Date(lastUpdated).toLocaleTimeString()}` : '']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DeviceList, {\n      devices: devices,\n      loading: loading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"IwwzcCoh18CaK+MAeQHhSiLx54g=\");\n_c = App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useEffect","useState","useRef","DeviceList","getDevices","connectWebSocket","jsxDEV","_jsxDEV","App","_s","devices","setDevices","loading","setLoading","realtime","setRealtime","wsStatus","setWsStatus","lastUpdated","setLastUpdated","wsRef","load","d","Date","toISOString","e","current","msg","type","topic","parts","split","deviceId","prev","idx","findIndex","id","device_id","copy","payload","last_telemetry","state","console","warn","onOpen","onClose","close","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","display","alignItems","gap","onClick","checked","onChange","target","fontSize","color","toLocaleTimeString","_c","$RefreshReg$"],"sources":["/home/aryo/projek-sistem-terdistribusi/projek-sistem-terdistribusi/ui/src/App.jsx"],"sourcesContent":["import React, {useEffect, useState, useRef} from 'react'\nimport DeviceList from './components/DeviceList'\nimport { getDevices } from './services/api'\nimport { connectWebSocket } from './services/ws'\nimport './styles.css'\n\nexport default function App(){\n  const [devices, setDevices] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [realtime, setRealtime] = useState(false)\n  const [wsStatus, setWsStatus] = useState('disconnected')\n  const [lastUpdated, setLastUpdated] = useState(null)\n  const wsRef = useRef(null)\n\n  const load = async ()=>{\n    try{\n      setLoading(true)\n      const d = await getDevices()\n      setDevices(d)\n      setLastUpdated(new Date().toISOString())\n    }catch(e){\n      setDevices([])\n    }finally{\n      setLoading(false)\n    }\n  }\n\n  // initial load only; manual refresh via the Refresh button\n  useEffect(()=>{ load() }, [])\n\n  // Manage WebSocket connection when realtime toggle changes\n  useEffect(()=>{\n    // turn on realtime: open WS; turn off: close WS\n    if(realtime){\n      setWsStatus('connecting')\n      wsRef.current = connectWebSocket((msg)=>{\n        try{\n          if(!msg) return\n          if(msg.type === 'mqtt' && msg.topic){\n            const parts = msg.topic.split('/')\n            const deviceId = parts[2]\n            if(!deviceId) return\n            setDevices(prev => {\n              const idx = prev.findIndex(d => d.id === deviceId || d.device_id === deviceId)\n              if(idx === -1) return prev\n              const copy = [...prev]\n              const payload = msg.payload || {}\n              copy[idx] = {\n                ...copy[idx],\n                last_telemetry: payload,\n                state: payload.state || copy[idx].state\n              }\n              return copy\n            })\n            setLastUpdated(new Date().toISOString())\n          }\n        }catch(e){\n          console.warn('ws msg handler error', e)\n        }\n      }, {\n        onOpen: ()=> setWsStatus('connected'),\n        onClose: ()=> setWsStatus('disconnected')\n      })\n    }else{\n      if(wsRef.current){\n        try{ wsRef.current.close() }catch(e){}\n        wsRef.current = null\n        setWsStatus('disconnected')\n      }\n    }\n    // cleanup on unmount\n    return ()=>{\n      if(wsRef.current){ try{ wsRef.current.close() }catch(e){} wsRef.current = null }\n    }\n  }, [realtime])\n\n  return (\n    <div className='app-root'>\n      <div className='header'>\n        <div className='title'>\n          <h1>üè° IoT Home Dashboard</h1>\n          <div className='small'>MQTT & Web UI</div>\n        </div>\n        <div style={{display:'flex',alignItems:'center',gap:'8px'}}>\n          <button className='btn' onClick={load}>Refresh</button>\n          <label style={{display:'flex',alignItems:'center',gap:'6px'}}>\n            <input type='checkbox' checked={realtime} onChange={(e)=>setRealtime(e.target.checked)} />\n            <span style={{fontSize:'12px'}}>Real-time</span>\n          </label>\n          <div style={{fontSize:12,color:'#888'}}>\n            {realtime ? `WS: ${wsStatus}` : `Mode: Manual`}\n            {lastUpdated ? ` ‚Ä¢ Updated: ${new Date(lastUpdated).toLocaleTimeString()}` : ''}\n          </div>\n        </div>\n      </div>\n\n      <DeviceList devices={devices} loading={loading} />\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}